---
layout: default
title: USD概述
nav_order: 2
description: ""
permalink: /docs/overview
---

# USD概述
{: .no_toc }
---
‎下面是关于USD主要功能的简要概述。该文档最初是一份内部备忘录，用来阐述USD的整体功能规划以及为什么需要这些功能，我们之前一直在比较内部使用的两个场景描述系统（Menva 和 TidScene），这也或多或少催生了开发USD的动机。而现在我们决定不在比较并将它们的功能结合在一起，于是就有了USD。当然其中也可能会有些功能令人困惑或者做的不够好，欢迎请‎‎在[USD技术论坛](https://groups.google.com/forum/#!forum/usd-interest)中告诉我们，以便我们可以解释或者改善。‎

‎本文档主要关注USD的‎‎[合成](https://graphics.pixar.com/usd/overview.html#USDFeatureSpecification-TerminologyComposition)功能‎‎方面，因为它们可能属于最令人陌生的概念。未来也会给出新的文档来讨论USD场景图表的机制，以及几何体和着色架构的细节。‎

#### 本页内容:
{: .no_toc }
1. TOC
{:toc}

## 问题描述
---
‎为了能够快速、经济地利用行业创新技术，在皮克斯，我们需要能够轻松地将新应用接入生产管线，以补充我们现有的工具集（包括我们专用的绑定与动画系统Presto），而不是使生产管线变得更加复杂。‎

‎而实现这一目标遇到多方面的障碍。其中一个主要因素是，我们应用之间的数据流框架本质上是一个异常复杂的格式转换器，结果是同一种数据却生成了多种表现（存储）形式。随着向姿势缓存管线的过渡，我们开始将更多数据转为一种更简单、跨软件的格式（TidScene），但到这并没有带来多少改善。而我们需要解决以下几个关键问题：‎

- 我们没有一个好的数据模型来表示所有工作流程。许多工作流内部已经拥有良好的数据模型，具有强大的分层和覆盖功能，但不同工作流之间的数据模型差异很大，我们花费了太多的时间和精力来转换数据，从而才能在工作流和数据包之间传递信息。‎
- ‎多种格式的资产与镜头文件导致更多的处理时间（Maya文件只能用Maya处理，Menva文件只能用Presto处理）。‎
- ‎我们依靠复杂的构建流程来生成我们需要的所有数据表示（由我们计划在生产管线中使用的应用程序决定），并保持同步。‎
- ‎即使扩展构建流程，也不是所有资产数据都能在所有应用之间互通（出于各种原因），这意味着在序列或镜头中只有部分数据能够被覆盖‎。
- 我们一直将构建变体作为资产的重要功能，但随着我们新动画系统的部署，变体是实时的，只能在动画系统中访问。
- 由于最后两点，艺术家需要预先规划资产在构建流程中的用途，因为在生产管线的末端就无法统一修改这些资产了


## 目标
---
从较高层次来讲。USD项目的目标在于：
- 提供模型和镜头（几何体、材质着色等）统一描述形式（数据模型），让任何应用程序都可以使用。
- 提供多种引用程序之间的数据通信方式，不仅要支持在各种应用程序中对数据进行分层、无损的编辑操作，同时也能够支持传统而且更可控的塌陷或烘焙操作。
- 为生产管线中的应用软件制定严格的通信协议
- 允许资产组合（集合）和镜头按需更新，而不必重新生成整个数据集
- 提供一种快速简洁的表示形式，同时便于扩展到大场景（可以有效控制应用程序的内存占用，项目所有资产和镜头的磁盘存储大小，以及网络带宽和缓存效率），而且方便调试。

对于项目生产最重要的三点：  
1. 稳定
2. 高效
3. 简单

### 为什么使用USD而不是Alembic
在USD项目开始时，对于Alembic和两个使用中的场景描述系统，我们有考虑过是否要在这三者之间选择一个作为基础来构建我们的场景数据管线。
不过很明显，文件引用和无损编辑的能力对于实现上述的可扩展以及增量更新的目标至关重要。虽然Alembic提供了一个足够好的解决方案来表示塌陷、烘焙或者动态的场景描述，但因为它并没有文件引用或者编码操作的能力，所以无法成为我们的管线数据的基础。

不过这并不排除将来Alembic和USD合并为一个实体。在此之前，原生Alembic文件可以作为USD中引用操作符的输入——也就是说，在一个USD场景中，用关系图来表示其中的文件引用关系的话，任何叶子节点都可以是Alembic文件。

### USD格式可以包含哪些数据
根据上述的目标，在我们的生产管线中，USD所包含的数据需要能够在绝大多数应用软件中使用。而该场景描述系统之外的数据则应该以最适合使用它的应用程序的格式存储（如：纹理与着色器定义），但是这些数据的呈现方式应该在USD中记录下来（如：一个指向本地文件的指针），从而一个USD文件就代表了最终的资产描述。

### 术语：什么是合成？
在本文档中，我们将讨论**合成场景描述**，**合成功能**，以及**合成选项**或者其他的**结构化的场景描述单元**。像是计算机图形学的许多术语一样，“合成”已经是一个通用且广泛使用的术语。对于USD，**合成**则表示“文件引用”和“分层”。合成行为遵循USD核心模块中定义的一套严格的规则，在本文档中，我们将概述这些行为所支持的特性。

## 动机：可移植的管线数据
---
这一节是对皮克斯管线中的对象进行的简要分类，因为他们与USD的目标息息相关。下面便是对资产结构的基本描述，而这些资产结构非常适合通过整个管线提供给每个应用程序使用。  

**模型：**
- 包含几何体、着色器和纹理数据，以及其他结构化数据
- 可能包含多个变体（如模型变体，材质变体，LOD等）
- 可以由其它模型组合而成（通过引用其他集合或模型组）
- 可能涉及到用于特定软件的绑定文件，但是这些数据不属于组合模型

**镜头：**
- 由模型组合而成
- 包含时间采样动画
- 包含分层的特效编辑和动画
- 包含相机信息
- 可能也包含灯光以及合成信息

**配置文件：**
- 由层次化的键值对组成
- 层次化结构横跨整个工作室，直至每个制作单位、电影，每个产品、序列以及每个模型

```
初看的话，配置似乎是一个与USD管线数据完全无关的问题，但是在皮克斯有很多系统
都会将配置数据以引用的方式进行覆盖，而在整个管线中都需要获取到那些数据。当然
这里配置文件是作为一种可选项，可以根据实际需求决定是否使用。
```

## 数据存储功能
---

### 数值表示
USD应支持对时间变化、层次化、键值对数据的存储。存储的数据应为强类型，并支持创建特定作用域的数据（如几何体和着色器等）

受性能和可移植性的限制，随时间变化的数据应该基于顶点采样而不是基于样条线。原因是：
- 应用程序之间对于顶点的操作行为是最一致的
- 由于样条线需要根据时间进行求值，会产生性能消耗
- 表示方式更简洁，不需要插值，只需要表示每一帧的数据
- 计算插值似乎超出了场景描述系统的范围

```
采样数据的插值应该留给应用软件去处理；USD核心能够提供数据的时间采样解析，但是
插值并不应该属于核心功能
```

### 数据组合与对象模型


### ASCII与二进制

## 合成功能
---

### 层

### 激活

### 覆盖式引用

### 变体

### 类与继承

### 模型层级

### 舞台载入与引用

### 命名空间排序

### 关系

### 数值剪辑

## 管线数据示例
---

### 模型

### 聚合模型（集合与组合）

### 镜头

## 附录